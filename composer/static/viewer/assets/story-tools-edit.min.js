!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;"undefined"!=typeof window?t=window:"undefined"!=typeof global?t=global:"undefined"!=typeof self&&(t=self),(t.storytools||(t.storytools={})).edit=e()}}(function(){return function e(t,n,a){function o(s,l){if(!n[s]){if(!t[s]){var i="function"==typeof require&&require;if(!l&&i)return i(s,!0);if(r)return r(s,!0);var p=new Error("Cannot find module '"+s+"'");throw p.code="MODULE_NOT_FOUND",p}var c=n[s]={exports:{}};t[s][0].call(c.exports,function(e){var n=t[s][1][e];return o(n?n:e)},c,c.exports,e,t,n,a)}return n[s].exports}for(var r="function"==typeof require&&require,s=0;s<a.length;s++)o(a[s]);return o}({1:[function(e,t,n){n.WPSClassify=e("./style/WPSClassify"),n.SLDStyleConverter=e("./style/SLDStyleConverter"),n.WFSDescribeFeatureType=e("./style/WFSDescribeFeatureType"),n.StyleComplete=e("./style/StyleComplete")},{"./style/SLDStyleConverter":2,"./style/StyleComplete":3,"./style/WFSDescribeFeatureType":4,"./style/WPSClassify":5}],2:[function(e,t,n){n.SLDStyleConverter=function(){return{generateStyle:function(e,t,n){var a=this.convertJSON(e,t);return this.context||(this.context=new owsjs.Jsonix.Context([owsjs.mappings.XLink_1_0,owsjs.mappings.Filter_1_0_0,owsjs.mappings.GML_2_1_2,owsjs.mappings.SLD_1_0_0],{namespacePrefixes:{"http://www.w3.org/1999/xlink":"xlink","http://www.opengis.net/sld":"sld","http://www.opengis.net/ogc":"ogc"}}),this.marshaller=this.context.createMarshaller()),n===!0?this.marshaller.marshalString(a):this.marshaller.marshalDocument(a)},createFill:function(e,t){return{cssParameter:[{name:"fill",content:[t&&t.style.symbol.fillColor?t.style.symbol.fillColor:e.symbol.fillColor]},{name:"fill-opacity",content:[String(t?(t.style.symbol.fillOpacity||100)/100:(e.symbol.fillOpacity||100)/100)]}]}},createStroke:function(e,t){var n;return"dashed"===e.stroke.strokeStyle?n="5":"dotted"===e.stroke.strokeStyle&&(n="1 2"),{cssParameter:[{name:"stroke",content:[t&&t.style.stroke.strokeColor?t.style.stroke.strokeColor:e.stroke.strokeColor]},{name:"stroke-width",content:e.stroke.strokeWidth?[String(e.stroke.strokeWidth)]:void 0},{name:"stroke-opacity",content:e.stroke.strokeOpacity?[String(e.stroke.strokeOpacity/100)]:void 0},{name:"stroke-dasharray",content:n?[n]:void 0}]}},createPolygonSymbolizer:function(e,t){var n=this.createFill(e,t),a=this.createStroke(e),o={name:{localPart:"PolygonSymbolizer",namespaceURI:"http://www.opengis.net/sld"},value:{fill:n,stroke:a}};return o},createPointSymbolizer:function(e,t){var n,a=this.createFill(e,t),o=this.createStroke(e);if(e.symbol&&e.symbol.graphic){var r=document.createElement("a");r.href=e.symbol.graphic+"?fill="+encodeURIComponent(t&&t.style.symbol.fillColor?t.style.symbol.fillColor:e.symbol.fillColor)+"&stroke="+encodeURIComponent(e.stroke.strokeColor),n=[{TYPE_NAME:"SLD_1_0_0.ExternalGraphic",fill:a,stroke:o,format:"image/svg+xml",onlineResource:{href:r.href}}]}else n=[{TYPE_NAME:"SLD_1_0_0.Mark",fill:a,stroke:o,wellKnownName:e.symbol&&e.symbol.shape||"circle"}];var s=1;return e.symbol&&angular.isDefined(e.symbol.fillOpacity)&&(s=Math.max(.01,e.symbol.fillOpacity)/100),{name:{localPart:"PointSymbolizer",namespaceURI:"http://www.opengis.net/sld"},value:{graphic:{externalGraphicOrMark:n,opacity:{content:[String(s)]},size:{content:[String(t&&t.style.symbol&&t.style.symbol.size||e.symbol&&e.symbol.size||10)]},rotation:e.symbol&&e.symbol.rotationAttribute?{content:["degrees"===e.symbol.rotationUnits?{name:{localPart:"PropertyName",namespaceURI:"http://www.opengis.net/ogc"},value:{content:[e.symbol.rotationAttribute]}}:{name:{localPart:"Div",namespaceURI:"http://www.opengis.net/ogc"},value:{expression:[{name:{localPart:"PropertyName",namespaceURI:"http://www.opengis.net/ogc"},value:{content:[e.symbol.rotationAttribute]}},{name:{localPart:"Div",namespaceURI:"http://www.opengis.net/ogc"},value:{expression:[{name:{localPart:"Function",namespaceURI:"http://www.opengis.net/ogc"},value:{name:"pi"}},{name:{localPart:"Literal",namespaceURI:"http://www.opengis.net/ogc"},value:{content:["360"]}}]}}]}}]}:void 0}}}},createLineSymbolizer:function(e,t){return{name:{localPart:"LineSymbolizer",namespaceURI:"http://www.opengis.net/sld"},value:{stroke:this.createStroke(e,t)}}},createTextSymbolizer:function(e){var t,n=e.label.fontFamily.toLowerCase();return"serif"===n?t="Serif":"sans-serif"===n?t="SansSerif":"cursive"===n?t="Comic Sans MS":"monospace"===n&&(t="Courier New"),{name:{localPart:"TextSymbolizer",namespaceURI:"http://www.opengis.net/sld"},value:{fill:{cssParameter:[{name:"fill",content:[e.label.fillColor]}]},halo:{fill:{cssParameter:[{name:"fill",content:["#FFFFFF"]}]},radius:{content:["1"]}},labelPlacement:{linePlacement:{}},font:{cssParameter:[{name:"font-family",content:t?[t]:void 0},{name:"font-size",content:[String(e.label.fontSize)]},{name:"font-style",content:[e.label.fontStyle]},{name:"font-weight",content:[e.label.fontWeight]}]},label:{content:[{name:{localPart:"PropertyName",namespaceURI:"http://www.opengis.net/ogc"},value:{content:[e.label.attribute]}}]},vendorOption:[{name:"maxDisplacement",content:"40"},{name:"autoWrap",content:"40"},{name:"spaceAround",content:"0"},{name:"followLine",content:"false"},{name:"group",content:"yes"},{name:"goodnessOfFit",content:"0.2"},{name:"conflictResolution",content:"true"}]}}},convertJSON:function(e,t){var n={name:{namespaceURI:"http://www.opengis.net/sld",localPart:"StyledLayerDescriptor"}};n.value={version:"1.0.0",namedLayerOrUserLayer:[{TYPE_NAME:"SLD_1_0_0.NamedLayer",name:t,namedStyleOrUserStyle:[{TYPE_NAME:"SLD_1_0_0.UserStyle",featureTypeStyle:[{rule:[]}]}]}]};var a,o=n.value.namedLayerOrUserLayer[0].namedStyleOrUserStyle[0].featureTypeStyle[0].rule;if(e.rules)for(var r=0,s=e.rules.length;s>r;++r){var l,i=e.rules[r];i.value?l={comparisonOps:{name:{namespaceURI:"http://www.opengis.net/ogc",localPart:"PropertyIsEqualTo"},value:{expression:[{name:{namespaceURI:"http://www.opengis.net/ogc",localPart:"PropertyName"},value:{content:[e.classify.attribute]}},{name:{namespaceURI:"http://www.opengis.net/ogc",localPart:"Literal"},value:{content:[String(i.value)]}}]}}}:i.range&&(l={comparisonOps:{name:{namespaceURI:"http://www.opengis.net/ogc",localPart:"PropertyIsBetween"},value:{expression:{name:{namespaceURI:"http://www.opengis.net/ogc",localPart:"PropertyName"},value:{content:[e.classify.attribute]}},lowerBoundary:{expression:{name:{namespaceURI:"http://www.opengis.net/ogc",localPart:"Literal"},value:{content:[String(i.range.min)]}}},upperBoundary:{expression:{name:{namespaceURI:"http://www.opengis.net/ogc",localPart:"Literal"},value:{content:[String(i.range.max)]}}}}}}),a={title:i.name,name:i.name,filter:l,symbolizer:[]},"point"===e.geomType?a.symbolizer.push(this.createPointSymbolizer(e,i)):"line"===e.geomType?a.symbolizer.push(this.createLineSymbolizer(e,i)):"polygon"===e.geomType&&a.symbolizer.push(this.createPolygonSymbolizer(e,i)),e.label&&null!==e.label.attribute&&a.symbolizer.push(this.createTextSymbolizer(e)),o.push(a)}else a={symbolizer:[]},o.push(a),"point"===e.geomType?a.symbolizer.push(this.createPointSymbolizer(e)):"line"===e.geomType?a.symbolizer.push(this.createLineSymbolizer(e)):"polygon"===e.geomType&&a.symbolizer.push(this.createPolygonSymbolizer(e)),e.label&&null!==e.label.attribute&&a.symbolizer.push(this.createTextSymbolizer(e));return n}}}},{}],3:[function(e,t,n){n.StyleComplete=function(){return{isComplete:function(e){if(void 0===e)return!1;if(e.classify)if("unique"===e.classify.method){if(null===e.classify.attribute||null===e.classify.maxClasses||!e.classify.colorPalette)return!1}else if(null===e.classify.method||null===e.classify.attribute||null===e.classify.colorRamp||0===e.rules.length)return!1;return!0}}}},{}],4:[function(e,t,n){n.WFSDescribeFeatureType=function(){this.parseResult=function(e){this.context||(this.context=new owsjs.Jsonix.Context([owsjs.mappings.XSD_1_0]),this.unmarshaller=this.context.createUnmarshaller());for(var t,n=this.unmarshaller.unmarshalString(e).value,a=n.targetNamespace,o=n.complexType[0].complexContent.extension.sequence.element,r=[],s=[],l=0,i=o.length;i>l;++l){var p=o[l];if("http://www.opengis.net/gml"===p.type.namespaceURI){var c=p.type.localPart;-1!==c.indexOf("Polygon")?t="polygon":-1!==c.indexOf("LineString")?t="line":-1!==c.indexOf("Point")&&(t="point")}else"dateTime"===p.type.localPart&&s.push(p.name);r.push({name:p.name,type:p.type.localPart,typeNS:p.type.namespaceURI})}return{timeAttribute:s.length>0?s[0]:null,featureNS:a,geomType:t,attributes:r}}}},{}],5:[function(e,t,n){n.WPSClassify=function(){this.parseResult=function(e){var t=(new DOMParser).parseFromString(e,"application/xml"),n=t.getElementsByTagNameNS("http://www.opengis.net/ows/1.1","ExceptionText");if(0===n.length){for(var a=t.getElementsByTagName("Class"),o=[],r=0,s=a.length;s>r;++r){var l=a[r].getAttribute("lowerBound"),i=a[r].getAttribute("upperBound");o.push({name:l+"-"+i,range:{min:l,max:i}})}return{success:!0,rules:o}}return{success:!1,msg:n[0].textContent}},this.createContext=function(){this.context=new owsjs.Jsonix.Context([owsjs.mappings.XLink_1_0,owsjs.mappings.OWS_1_1_0,owsjs.mappings.Filter_1_1_0,owsjs.mappings.OWS_1_0_0,owsjs.mappings.SMIL_2_0,owsjs.mappings.SMIL_2_0_Language,owsjs.mappings.GML_3_1_1,owsjs.mappings.WFS_1_1_0,owsjs.mappings.WPS_1_0_0],{namespacePrefixes:{"http://www.w3.org/1999/xlink":"xlink","http://www.opengis.net/wps/1.0.0":"wps","http://www.opengis.net/ows/1.1":"ows","http://www.opengis.net/wfs":"wfs"}}),this.marshaller=this.context.createMarshaller()},this.getUniqueValues=function(e,t){this.context||this.createContext();var n=this.generateMainConfig("gs:Unique","application/json",e);return n.value.dataInputs.input.push({identifier:{value:"attribute"},data:{literalData:{value:e.attribute}}}),t===!0?this.marshaller.marshalString(n):this.marshaller.marshalDocument(n)},this.generateMainConfig=function(e,t,n){return{name:{localPart:"Execute",namespaceURI:"http://www.opengis.net/wps/1.0.0"},value:{service:"WPS",version:"1.0.0",identifier:{value:e},responseForm:{rawDataOutput:{identifier:{value:"results"},mimeType:t}},dataInputs:{input:[{identifier:{value:"features"},reference:{method:"POST",mimeType:"text/xml",href:"http://geoserver/wfs",body:{content:[{name:{namespaceURI:"http://www.opengis.net/wfs",localPart:"GetFeature"},value:{outputFormat:"GML2",service:"WFS",version:"1.1.0",query:[{typeName:[{ns:n.featureNS,lp:n.typeName.split(":")[1]||n.typeName,p:n.featurePrefix}]}]}}]}}}]}}}},this.classifyVector=function(e,t){this.context||this.createContext();var n=this.generateMainConfig("vec:FeatureClassStats",void 0,e);return n.value.dataInputs.input.push({identifier:{value:"attribute"},data:{literalData:{value:e.attribute}}},{identifier:{value:"classes"},data:{literalData:{value:String(e.numClasses)}}},{identifier:{value:"method"},data:{literalData:{value:e.method}}},{identifier:{value:"stats"},data:{literalData:{value:"mean"}}}),t===!0?this.marshaller.marshalString(n):this.marshaller.marshalDocument(n)}}},{}]},{},[1])(1)});